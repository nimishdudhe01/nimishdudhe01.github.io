---
layout: post
title: Avalanche Fundamentals — Consensus Mechanism Explained!
tag:
- consensus-algorithm
- avalanche
- consensus
- web3
- blockchain
---

<h3>Avalanche Fundamentals — Consensus Mechanism Explained!</h3><h4>Learning about the Avalanche Ecosystem — Part I</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*ht2WgGu5HHBGbWyUT6Ll9w.png" /></figure><h3>What is a Consensus Mechanism?</h3><p>Consensus plays a crucial role in blockchain networks. The main objective of a consensus mechanism is to create a single version of truth. i.e. Universally accepted by all the participants in the network. These participants can reach consensus by following a couple of steps called the consensus protocol. This is their way to decide what state of the system is valid and all the state changes. There are many different consensus mechanisms.</p><h4>Double Spending Attack</h4><p>Double spending attack is an attack when a user is trying to spend funds that they don’t have. This is done by creating multiple transactions referring to the same funds.</p><h4>Let’s understand this with an example</h4><p>I. Alice owns 5 <strong>AVAX </strong>(AVAX is the native cryptocurrency of the Avalanche platform).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/764/1*F3S-6RUtkcG536QhhouspA.png" /><figcaption>Source: All the images for illustrations are from <a href="https://academy.avax.network/">Avalanche Academy</a></figcaption></figure><p>II. Alice now issues two transactions at same time to two different validators. First stating “<strong>Send 5 AVAX to Bob</strong>” and Second stating “<strong>Send 5 AVAX to Charlie</strong>”. And tries to execute the payments on the same time.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/764/1*xg2zMz4U2lUfSKttW97tKQ.png" /></figure><p>III. Both of these transactions are valid as she has 5 AVAX and she can send it to both Bob and Charlie. But as she has only 5 AVAX, She can’t do both.</p><p>IV. The system has to decide which of these two transactions is valid and where the funds will go and its important to understand that there’s very limited notion of time in blockchain systems so the validators as collective have no way of to identify which transaction was submitted to the system first.</p><p>V. Now the validators have to go through the consensus protocol to determine the decision. And different blockchain systems have different consensus mechanisms.</p><h3>So, What is Avalanche Consensus?</h3><ul><li>The avalanche consensus relies on the principle of <strong>Repeated Sub-Sampling Voting</strong>.</li><li>When we look at our validators, each validator might have an initial preference or no preference at all of which of these two transactions is valid or should be included in the blockchain.</li><li>Let’s say we have a room full of n validators i.e. 25. So the first parameter of the consensus we have is the number of participants (n).</li><li>So now we have to decide on a sample size (k). So let’s say each round of sub-sampling we are asking 5 of the validators. This has to be a number between 1 and n.</li><li>We are going to ask 5 random validators and they’re gonna tell us something. Should the funds go to Charlie or to Bob.</li><li>Now we have the Quorum size (α) — the fraction of the sample size we need to convince us to change our preference. Ex. We have a clear majority of 3 out of 5 that have the same preference, we are going to change our preference.</li><li>In our example let’s say we are asking 5 different validators and 3 of them say that we think we should send the funds to Bob. Since we have a simple majority, at this point we will change our view on the system. we’re gonna change our personal preference also to Bob.</li><li>Then comes the concept of decision threshold (β). That is if I repeat this again and again, how many times in a row do I need to hear the same majority of the Quorum having the same opinion.</li><li>Let’s say that the decision threshold is 8. So if we repeatedly perform sub-sample voting, asking 5 random validators of the 25, 8 times in a row, and 3 of the 5 (Quorum) will repeatedly tell that they think it should be Bob. Their preference is Bob.</li><li>Then I log in my final decision and will not change my mind anymore.</li></ul><h4>In Short:</h4><ol><li><strong>Number of Validators</strong> = <strong>Number of participants</strong> in network = <strong>n</strong></li><li>Out of these n Validators, <strong>k (sample size)</strong> random validators will be selected and asked for their decision on which transaction to prefer.</li><li>Out of these k Validators, The preference will be selected when the same preference has a majority i.e. <strong>votes &gt; Quorum size (α)</strong>.</li><li>This is done consecutively for a number of times which is called the <strong>Decision Threshold (β)</strong>.</li><li>Finally after a preference is decided, The system will log in their decision and not change their mind anymore.</li></ol><h4>Illustration:</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/785/1*03ei4Ol_TBAOpWRZek4-IA.png" /><figcaption>The First Round of Voting Takes Place with 5 Validators With our preference as Yellow.</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/785/1*adSOAXj4y6v0V3suw9oczQ.png" /><figcaption>As 3 out of 5 participants vote Blue, Our preference changes to Blue (Bob).</figcaption></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/785/1*zSyW0r7kgyrpE3ZRa_h66w.png" /><figcaption>Another 5 random participants selected for voting the preference</figcaption></figure><p>This is done a number of times which is known as the Decision Threshold (β).</p><p>Blue Means transaction to Bob is being preferred by the participant and Yellow Means Charlie.</p><h4>Pseudo-Code of the Mechanism</h4><pre>preference := bob<br>consecutiveSuccesses := 0<br><br>while not decided:<br> ask k random people their preference<br> <br> if &gt;= a give the same response :<br>  preference := response with &gt;= a<br>  <br>  if preference == old preference:<br>   consecutiveSuccesses += 1<br>  else:<br>   consecutiveSuccesses = 1<br> else:<br>  consecutiveSuccesses = 0<br> if consecutiveSuccesses &gt; β<br>  decide(preference)</pre><h4>How to decide if a consensus mechanism is good?</h4><p>There are two parameters we can use to determine if a consensus mechanism is good:</p><ul><li>Time to finality: From the moment I submitted transaction to the system, how long does it take till it’s finalized and cannot be changed.</li><li>Throughput: How many transactions can be decided on per second.</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/630/1*HK0apUe08ywpmBrSxfTJug.png" /><figcaption><strong>Throughput and Time to Finality are not related at all!</strong></figcaption></figure><h4>Comparison with other blockchain networks:</h4><pre>+-----------+---------------------+------------------+<br>|  Network  |     Throughput      | Time to Finality |<br>+-----------+---------------------+------------------+<br>| Bitcoin   | 7 TPS               | 60 min           |<br>| Ethereum  | 30 TPS              | 6.4 min          |<br>| Avalanche | 2500 TPS per Subnet | ~0.8 seconds     |<br>+-----------+---------------------+------------------+</pre><p>TPS = Transactions Per Second</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/745/1*PEC0Vw0t4TXgq3hcLZTa6w.png" /></figure><p>Visual Representation of the above data Comparing Avalanche with Ethereum and Bitcoin</p><h4>Demonstration of Snowball protocol in Action</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*iKsBop2cdTLc5Zr-cs4EpA.gif" /></figure><p>Introduced by <em>Team Rocket, </em><a href="https://assets.website-files.com/5d80307810123f5ffbb34d6e/6009805681b416f34dcae012_Avalanche%20Consensus%20Whitepaper.pdf"><em>Scalable and Probabilistic Leaderless BFT Consensus through Metastability (2020)</em></a>Avalanche Consensus, the Snow algorithm similarly solves the agreement problem in the face of Byzantine nodes. Snow consensus powers <a href="https://avax.network">Avalanche</a> to achieve a distributed consensus on the chain without relying on any trusted third party.</p><p>Link to the Demo: <a href="https://tedyin.com/archive/snow-bft-demo/">https://tedyin.com/archive/snow-bft-demo/</a></p><p>Link to Github Repository: <a href="https://github.com/Determinant/snow-bft-demo">https://github.com/Determinant/snow-bft-demo</a></p><h4>Finalization</h4><p>In the common case when a transaction has no conflicts, finalization happens very quickly. When conflicts exist, honest validators quickly cluster around conflicting transactions, entering a positive feedback loop until all correct validators prefer that transaction. This leads to the acceptance of non-conflicting transactions and the rejection of conflicting transactions.</p><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FSfb8G54AM_4%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DSfb8G54AM_4&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FSfb8G54AM_4%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" width="854" height="480" frameborder="0" scrolling="no"><a href="https://medium.com/media/25dba534af808e7ecf58c2516131a753/href">https://medium.com/media/25dba534af808e7ecf58c2516131a753/href</a></iframe><h4>References:</h4><ol><li><a href="https://academy.avax.network/">https://academy.avax.network/</a></li><li><a href="https://www.gyuho.dev/nakamoto-bitcoin-vs-snow-avalanche-consensus.html">https://www.gyuho.dev/nakamoto-bitcoin-vs-snow-avalanche-consensus.html</a></li><li><a href="https://www.avax.network/blog/time-to-finality-ttf-the-ultimate-metric-for-blockchain-speed">https://www.avax.network/blog/time-to-finality-ttf-the-ultimate-metric-for-blockchain-speed</a></li><li><a href="https://assets.website-files.com/5d80307810123f5ffbb34d6e/6009805681b416f34dcae012_Avalanche%20Consensus%20Whitepaper.pdf">https://assets.website-files.com/5d80</a><a href="https://github.com/ava-labs/avalanche-faucet#tldr">TL;DR</a><a href="https://assets.website-files.com/5d80307810123f5ffbb34d6e/6009805681b416f34dcae012_Avalanche%20Consensus%20Whitepaper.pdf">307810123f5ffbb34d6e/6009805681b416f34dcae012_Avalanche%20Consensus%20Whitepaper.pdf</a></li></ol><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=cb2db0a59fb8" width="1" height="1" alt=""><hr><p><a href="https://medium.com/coinmonks/avalanche-fundamentals-consensus-mechanism-explained-cb2db0a59fb8">Avalanche Fundamentals — Consensus Mechanism Explained!</a> was originally published in <a href="https://medium.com/coinmonks">Coinmonks</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
